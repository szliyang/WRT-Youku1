<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>优酷土豆路由宝</title>
<link rel="stylesheet" type="text/css" href="css/reset.css?ver=20160121">
<link rel="stylesheet" type="text/css" href="css/popup.css?ver=20160121">
<link rel="stylesheet" type="text/css" href="css/tab.css?ver=20160121">
<link rel="stylesheet" type="text/css" href="css/form.css?ver=20160121">
<link rel="stylesheet" type="text/css" href="css/widget.css?ver=20160121">
<link rel="stylesheet" type="text/css" href="css/networkset.css?ver=20160121">
<link rel="stylesheet" type="text/css" href="extend/css/hefot.css?ver=20160121">
<link rel="stylesheet" type="text/css" href="css/System.css?ver=20160121">
<script type="text/javascript" charset="utf-8"  src="js/jquery.min.js?ver=20160121"></script>
<script type="text/javascript" charset="utf-8"  src="js/jquery.base64.js?ver=20160121"></script>
<script type="text/javascript" charset="utf-8"  src="js/jquery.cookie.js?ver=20160121"></script>
<script type="text/javascript" charset="utf-8"  src="js/jquery.tabs.js?ver=20160121"></script>
<script type="text/javascript" charset="utf-8"  src="js/public.js?ver=20160121"></script>
<script type="text/javascript" charset="utf-8"  src="js/json2.js?ver=20160121"></script>
<script type="text/javascript" charset="utf-8"  src="js/validate.js?ver=20160121"></script>
<script type="text/javascript" charset="utf-8"  src="js/nodeClick.js?ver=20160121"></script>
<script type="text/javascript" charset="utf-8"  src="js/popup.js?ver=20160121"></script>
<script type="text/javascript" charset="utf-8"  src="js/doT.js?ver=20160121"></script>
<script type="text/javascript" charset="utf-8"  src="extend/js/common.js?ver=20160121"></script>
<script type="text/javascript" charset="utf-8"  src="js/page.js?ver=20160121"></script>
<script type="text/javascript" charset="utf-8"  src="js/upgrade.js?ver=20160121"></script>
</head>
<body>
  <div class="header_body" style="min-width: 1250px;">
    <div class="logo"></div>
    <div class="nav">
       <ul class="nav_top" id="topmenu">
        <li><a href="##" dataurl="dashboard.html" class="topmenu">首页</a></li>
        <li><a href="##" dataurl="wan.html" class="topmenu">连网设置</a></li>
        <li><a href="##" dataurl="wireless.html" class="topmenu">Wi-Fi设置</a></li>
        <li><a href="##" dataurl="device.html" class="topmenu">设备管理</a></li>
        <li class="current"><a href="##" dataurl="advanced_setting.html" class="topmenu current">更多设置</a></li>
       </ul>
    </div>
    <div class="nav_right"></div>
</div>
     <div class="nav-con">
      <ul class="nav-lists clearfix">
        <li class="current"><a href="##" dataurl="advanced_setting.html" class="topmenu current">高级设置</a></li>
        <li ><a href="##" dataurl='upgrade.html' class="topmenu">系统升级</a></li>
        <li><a href="##" dataurl='password.html' class="topmenu">管理密码</a></li>
        <li class="lisd "><a href="##" dataurl='reboot_reset.html' class="topmenu">重启与恢复</a></li>
      </ul>
    </div>
   <div class="box box_top">
	<ul class="tab_menu">
		<li data-value="neiwang" class="current"><a href="###">内网设置</a></li>
		<li data-value="dhcp"><a href="###">DHCP服务</a></li>
		<li data-value="mtu"><a href="###">MTU设置</a></li>
		<li data-value="upnp"><a href="###">UPnP设置</a></li>
		<li data-value="Port"><a href="###">端口转发/DMZ</a></li>
        <li data-value="forwarding"><a href="###">网址过滤</a></li>
		<li data-value="lightmode"><a href="###">面板灯</a></li>
	</ul>
	<div class="tab_box">
		<div class="tab_guan">
		    <div class="neiwang">设置网关、子网掩码</div>
			<form id="innerNetBaseSetForm">
		    <div class="form_tip form_tips">
            
		        <label for="oldPwd">网关:</label>
		        <input type="text" id="lanipaddr" data-rules="required|gateip|gate" data-required-error="网关地址不能为空" data-gateip-error="网关地址格式不正确" data-gate-error="该网段为预留网段，不能设定" maxlength="15"/>
		    </div>
		    <div class="form_tip">
		        <label for="oldPwd">子网掩码:</label>
		        <input type="text" id="lannetmask" data-rules="required|mask" data-required-error="子网掩码不能为空" data-mask-error="子网掩码格式不正确" maxlength="15"/>
		    </div>
		    <div class="baocun_btn save-btn" id="saveNetWork">保 存</div>
			</form> 
		</div>
		<div class="neiwang_fu hide">
		    <div class="neiwang">为连接到路由宝的设备自动分配IP</div>
			<form id="DHCPSetForm">
		    <div class="fenpei  clearfix">
		      <div class="fenpei_bi">
		          <span class="dhcp">DHCP服务:</span>
		          <span class="dhcp_open opened" id="DHCPChange"></span>
		           <p>关闭后，路由宝不再为连接设备自动分配IP地址<br/>需在设备上手工设置IP地址、子网掩码、默认网关、DNS服务后才能上网。</p>
		      </div>
		      <div class="fenpeifanwei">
		          <span class="ipfen">IP分配范围:</span>
		          <span class="quzhi" id="ipSection">192.168.11</span>
		          <input type="text" class="shebei_P" id="rangeFrom1" data-rules="integer|range=1,254" data-range-error="请输入1-254的整数" data-integer-error="请输入1-254的整数" maxlength="3"/>
		          <span class="quzhi_p">至</span>
		          <input type="text"  class="shebei_Pa" id="rangeTo1" data-rules="integer|range=1,254|size" data-range-error="请输入1-254的整数" data-integer-error="请输入1-254的整数" data-size-error="输请输入正确的范围" maxlength="3"/>
		          <span class="error-tip" id="DHCPErr" style="top:224px;left:703px;visibility:hidden"></span>
		      </div>
		      <div class="baocun_btn_t save-btn" id="saveDHCPSet">保 存</div>
		    </div>
			</form>
		</div>
		<div class="mtushezhi hide">
		    <div class="neiwang">设置TCP/IP协议传输数据时的最大传输单元</div>
			<form id="MTUSetForm">
		    <div class="kuandai_bo">
		        <div class="morenzhi">
				    <span class="error-tip" id="MTUErr" style="top:-43px;left:-8px;visibility:hidden"></span>
		            <input type="text" id="MTU" data-rules="required|integer|range=576,1500" data-required-error="MTU值不能为空" data-range-error="MTU设置范围576-1500" data-integer-error="MTU格式不正确"  maxlength="4">
		            <a href="##" id="useDefaultMTU">使用默认值</a>
		        </div>
		        <p>请按照宽带运营商或网络管理员的要求设置</p>
		        <div class="baocun_btn_t baocun_btn_t_cun save-btn" id="saveSetMTU">保 存</div>
		    </div>
			</form>
		</div>
		<div class="UPnpshezhi hide">
		    <div class="neiwang">设置UPnP（通用即插即用）</div>
			<div>
			<span class="upnpstaref">UPnP状态：</span>
		    <div class="kongzhi opened" id="UPnPChange"></div>
			</div>
	        <div class="xietong" id="UPnPRef">开启UPnP后有助于提高局域网内P2P类软件的网速，如在线视频和多点下载等。</div>
	        <div class="xietong xietong_hidden"></div>
			<script type="text/template" id="currentupnpListTemplate">
			<span id="UPnPDevRef" class="upnpref">UPnP设备</span><a href="#" id="refreshupnp" class="refreshupnp"></a>
            <table class="biaoge_upnp clearfix" cellspacing="0" cellpadding="0" id="oreredlist">
            <tr ><th class="th1">协议</th><th class="th2">应用名称</th><th class="th3">客户端IP</th><th class="th4">内部端口</th><th class="th5">外部端口</th></tr>
            {{if(!it.data) { }}
        	   <tr><td colspan="5" style="text-align:center;color:#999999;border-right:none;">暂无UPnP设备</td></tr>
        	{{ }else { }}
			{{ for (var i = 0,l = it.data.length;i < l;i++) { }}
			<tr>
                <td>{{=it.data[i].protocol}}</td>
                <td>{{=it.data[i].name}}</td>
                <td>{{=it.data[i].ip}}</td>
                <td>{{=it.data[i].intport}}</td>
                <td class="td_lis">{{=it.data[i].extport}}</td>
            </tr>
			{{ } }}
			{{ } }}
			</table>
			</script>
			<div id="upnpCurrentList" style="margin-top: 20px;overflow:hidden;"></div>
		    <div class="baocun_btn_tn save-btn" id="saveUPnP">保 存</div>
		</div>
		<div class="Port_forwarding hide">
		   <div class="neiwang">可将内网某个设备映射到外网，方便从外网访问该设备</div>
		   <div class="fangceng">
            <span>端口转发/DMZ设置:</span>
            <p class="guan_close closre"></p>
            </div>
            <div class="duankou_fa" id="duankou_fa" style="display:none;">
		   <div class="nei_zhi">
		       <span>转发方式:</span>
		       <div class="duankou">
		           <a href="##" class="riadod active_radio" id="redirectradio"></a>
		           <strong>设置转发规则</strong>
		       </div>
		       <div class="dzw">
		           <a href="##" class="riadod" id="dmzradio"></a>
		           <i>DMZ</i>
		       </div>
		   </div>
        <div class="zhuanfa_gui conFocus_be conFocus clearfix" id="redirectpanal">
            <div class="gui_ze clearfix">
                <span>端口转发规则</span>
                <a href="##" class="tian_jia">添加规则</a>
            </div>
		<script type="text/template" id="currentrdrListTemplate">
        <table class="biaoge_duankou clearfix" cellspacing="0" cellpadding="0" id="oreredlist">
            <tr ><th class="th1">名称</th><th class="th2">协议</th><th class="th3">外部端口</th><th class="th4">内部IP地址</th><th class="th5">内部端口</th><th class="th6">操作</th></tr>
            {{if(!it.data) { }}
        	   <tr><td colspan="6" style="text-align:center;color:#999999;border-right:none;">暂无端口转发规则</td></tr>
        	{{ }else { }}
			{{ for (var i = 0,l = it.data.length;i < l;i++) { }}
			<tr>
                <td>{{=it.data[i].name}}</td>
                <td>
				{{if(it.data[i].proto=="tcp") { }}
                       TCP
                 {{ } else if(it.data[i].proto=="udp") { }}
                       UDP
				 {{ } else { }}
                       TCP+UDP
                 {{ } }}
				</td>
                <td>{{=it.data[i].src_dport}}</td>
                <td>{{=it.data[i].dest_ip}}</td>
                <td>{{=it.data[i].dest_port}}</td>
                <td class="td_lis"><a href="##" class="bian_k" data-name="{{=it.data[i].name}}" data-port="{{=it.data[i].src_dport}}">编辑</a>
				    <a href="##" class="del_pas" data-name="{{=it.data[i].name}}" data-port="{{=it.data[i].src_dport}}">删除</a></td>
            </tr>
			{{ } }}
			{{ } }}
        </table>
		</script>
		<div id="rdrCurrentList"></div>
        </div>
        <div class="dmz_shw conFocus_be" id="dmzpanal">
            <div class="ip_drass">
                <strong>DMZ主机IP地址：</strong>
                <span id="dmzpreip">192.168.1.&nbsp;</span>
				<div class="error-tip" id="dmziperror" style="margin-left:760px;margin-top:310px;width:110px;display:none;">请输入1~254的数字</div>
                <input type="text" id="dmzlastip" maxlength="3"  
                 onkeydown="if(event.keyCode==13)event.keyCode=9" onKeypress="if((event.keyCode<48 || event.keyCode>57)) event.returnValue=false">
            </div>
        </div>
        </div>
		<a href="##" class="bao_bcun">保存</a>
        <div class="shengxiao_d">生效中...</div>
		</div>
		<div class="forwarding_zhi hide">
		    <div class="neiwang">设置禁止访问的网站</div>
		    <div class="fangceng fangceng4">
            <span class="m_t_p">网址过滤:</span>
            <p class=" closre guan_close2"></p>
            </div>
            <div class="zhuanfa_gui conFocus clearfix" id="urlfilterlistbox" style="display:none">
            <div class="gui_ze clearfix">
                <span>网址过滤列表</span>
                <a href="##" class="qing_jia88">清空</a>
                <a href="##" class="tian_jia88">添加网址</a>
            </div>
			<script type="text/template" id="currenturlfilterListTemplate">
			    <table class="biaoge_duankou clearfix" cellspacing="0" cellpadding="0" id="oreredlist" >
			    <tr ><th class="th11">网址(域名)</th><th class="th22">备注</th><th class="th33">操作</th></tr>
			    {{if(!it.data) { }}
        	        <tr><td colspan="3" style="text-align:center;color:#999999;border-right:none;">暂无要过滤的网址</td></tr>
				{{ }else { }}
				{{ for (var i=0,l = it.data.length;i < l;i++) { }}
				   <tr class="urlfiltertr urlfiltertrn{{=i}}" >
					<td>{{=it.data[i].domainname}}</td>
					<td>{{=it.data[i].domainref}}</td>
					<td class="td_lis"><a href="##" class="del_urlfilter" data-name="{{=it.data[i].domainname}}" data-ref="{{=it.data[i].domainref}}">删除</a></td>
				   </tr>
				{{ } }}
				{{ } }}
			    </table>
			</script>
            <div id="urlfilterCurrentList"></div>
			<div id="urlfilterpage" style="margin-top:5px; text-align:center;">
				<div name="laypage1.2" class="laypage_main laypageskin_default" id="laypage_8"></div>
			</div>
            </div>
        
            <a href="##" class="bao_bcun2" style="display:block">保存</a>
            <div class="shengxiao_d">生效中...</div>
        </div>
        <div class="mianban hide">
		     <div class="neiwang">设置面板灯模式</div>
			 <form id="lightsetForm">
		     <div class="biaozhun">
		        <div class="biao_left biao_left_hei">
		            <span class="acti_biao "></span>
		            <p class="zhun">标准</p>
		        </div>
		         <div class="biao_right">
		            <span class="acti_biao_tn"></span>
		            <p class="zhunbei">夜间</p>
		        </div>
		     </div>
		     <div class="quantian">面板灯全天点亮</div>
		     <div class="yejian"><span>面板灯关闭时段</span>
			 <input type="text" maxlength="2" value="22" id="hourfrom" data-rules="required|integer|range=0,23"  data-required-error="时间不能为空" data-integer-error="请输入数字" data-range-error="时间错误"/>&nbsp;:&nbsp;
			 <input type="text" maxlength="2" value="00" id="minfrom" data-rules="required|integer|range=0,59"  data-required-error="时间不能为空" data-integer-error="请输入数字" data-range-error="时间错误"/>&nbsp;~&nbsp;
			 <input type="text" maxlength="2" value="08" id="hourto" data-rules="required|integer|range=0,23"  data-required-error="时间不能为空" data-integer-error="请输入数字" data-range-error="时间错误"/>&nbsp;:&nbsp;
			 <input type="text" maxlength="2" value="00" id="minto" data-rules="required|integer|range=0,59|sparetime"  data-required-error="时间不能为空" data-integer-error="请输入数字" data-range-error="时间错误" data-sparetime-error="开始和结束时间不能相同"/></div>
		     <span class="error-tip" id="LightErr" style="visibility:hidden;top:208px;left:506px;"></span>
		     <div class="baocun_nt save-btn" id="saveLight">保 存</div>
		     
			 </form>
		</div>
		</div>
		
	</div>
<div class="footer"></div> 
<!--端口转发规则弹层-->

<div class="laver" id="tian_jia">
    <form id="RDRSetForm">
    <a href="##" class="btn_hov"></a>
    <p>端口转发规则</p>
    <div class="nam_bt1">
       <label>名称:</label>
	   <div class="error-tip" style="width:130px;margin-left:32px;top:-41px;display:none;"></div>
       <input type="text" id="RDRname" class="comn-inputa" data-rules="required|maxLength=20" data-required-error="名称不能为空" data-maxLength-error="名称不能超过20个字符" maxlength="25">
    </div>
    <div class="nam_bt1">
     <label>协议:</label>
    <div id="divselect" class="divselect">
        <span class="label" id="RDRProto" data-panel="tcp">TCP</span>
        <ul class="list">
            <li><a href="javascript:;" selectid="1" data-panel="tcp">TCP</a></li>
            <li><a href="javascript:;" selectid="2" data-panel="udp">UDP</a></li>
            <li><a href="javascript:;" selectid="3" data-panel="tcp udp">TCP+UDP</a></li>
        </ul>
    </div>
    </div>
    <div class="nam_bt1">
       <label>外部端口:</label>
       <div class="error-tip" style="margin-left:32px;top:-41px;display:none;"></div>
       <input type="text" id="RDRSPort" class="comn-inputa error" data-rules="required|number|range=1,65535|obligate|conflict" data-required-error="外部端口不能为空" data-number-error="请输入1~65535的数字" data-range-error="请输入1~65535的数字" data-obligate-error="此端口已被系统使用,请更换" data-conflict-error="端口冲突,请更换" maxlength="5">
    </div>
    <div class="nam_bt1">
       <label>内部IP地址:</label>
	   <div class="error-tip" style="margin-left:32px;top:-41px;display:none;"></div>
       <input type="text" id="RDRDIP" class="comn-inputa" data-rules="required|ip|ipcon" data-required-error="IP地址不能为空" data-ip-error="IP地址格式不正确" data-ipcon-error="不是内网IP地址" maxlength="15">
    </div>
    <div class="nam_bt1">
       <label>内部端口:</label>
	   <div class="error-tip" style="margin-left:32px;top:-41px;display:none;"></div>
       <input type="text" id="RDRTPort" class="comn-inputa" data-rules="required|number|range=1,65535" data-required-error="内部端口不能为空" data-number-error="请输入1~65535的数字" data-range-error="请输入1~65535的数字" maxlength="5">
    </div>
    <div class="lay_mi">
        <a href="##" class="kou_r">添 加</a>
		<a href="##" class="save-btn" style="display:none;" id="rdrsavebtn"></a>
        <a href="##" class="kou_r2 cancel">取消</a>
    </div>
	</form>
</div>

<!-- 添加网址弹层-->
<div class="tian_wang" id="tian_jia88">
    <form id="UrlFilterSetForm">
    <a href="##" class="bi_c"></a>
    <h2>添加网址</h2>
    <p>请输入禁止访问的网站域名。如输入*.abc.com<br/>
将会自动屏蔽www.abc.com、bbs.abc.com、<br/>
abc.com等一系列域名。
    </p>
    <div class="name_b">
        <span>网址(域名):</span>
		<div class="error-tip" style="width:130px;margin-left:74px;top:132px;display:none;"></div>
        <input type="text" id="domainName" class="comn-inputa" data-rules="required|domain|conflictto" data-required-error="域名不能为空" data-domain-error="域名格式不正确" data-conflictto-error="列表中已存在此域名" maxlength="67">
    </div>
    <div class="name_b">
        <span>备注:</span>
		<div class="error-tip" style="margin-left:74px;top:183px;display:none;"></div>
        <input type="text" id="domainRef" class="comn-inputa" data-rules="maxLengthnomust=25" data-maxLengthnomust-error="备注不能超过25个字符" maxlength="25">
    </div>
    <div class="toamk">
        <a href="##" class="tian_tew">添加</a>
		<a href="##" class="save-btn" style="display:none;" id="urlfiltersavebtn"></a>
        <a href="##" class="quxiao_wi">取消</a>
    </div>
	</form>
</div>

<!--清空网址弹层-->
<div class="clear_t" id="qing_jia88">
    <a href="##" class="mind"></a>
    <h2>清空网址</h2>
    <p>您确定清空所有网址吗？</p>
    <div class="quedd">
        <a href="##" class="kong_tp">确定</a>
         <a href="##" class="kong_tp2">取消</a>
    </div>
</div>
<script type="text/javascript">

var currediractlist={};
var curupnplist={};
var cururlfilterlist={};
var curdmzpreip = "";
var currentrdrmode = "0";
var currenturlfmode = "0";
var rdrCurrentList=$("#rdrCurrentList");
var upnpCurrentList = $("#upnpCurrentList");
var urlfilterCurrentList=$("#urlfilterCurrentList");
var isSuccess = false;
var urlfilterisSuccess = false;
var editlistindex = -1;
var editlistflag = false;
var editurllistflag = false;
var innerNetBaseSet={};
var pagesize=5;

$('.guan_close2').on("click",function(){
	 var _this=$(this);
	if(_this.hasClass("closre")){
		_this.removeClass("closre");
		$("#urlfilterlistbox").show();
		currenturlfmode = "1";
	}else{
		_this.addClass("closre"); 
        $("#urlfilterlistbox").hide();
		currenturlfmode = "0";
	}
	$(".bao_bcun2").show();
});

$('.guan_close').on("click",function(){
	 var _this=$(this);
	if(_this.hasClass("closre")){
		_this.removeClass("closre");
		$(".duankou_fa").show();
		if($("#redirectradio").hasClass("active_radio")){
		    currentrdrmode = "1";
		}else{
		    currentrdrmode = "2";
		}
	}else{
		_this.addClass("closre"); 
        $(".duankou_fa").hide();
		currentrdrmode = "0";
	}
	$(".bao_bcun").show();
});

$(".bao_bcun").on("click",function(){
     var _this=$(this);
    _this.hide();
    $(".shengxiao_d").show();
	
	if(currentrdrmode == "0"){
	    if(currentrdrmode == innerNetBaseSet.redirecttype){
		    popup.tip("您未做任何修改,无需保存！","","noupdate");
			_this.show();
            $(".shengxiao_d").hide();
		}else{
		    setredirectinfo(currentrdrmode,currediractlist,"");
		}
	}else if(currentrdrmode == "1"){
	    if(currentrdrmode == innerNetBaseSet.redirecttype && !editlistflag){
		    popup.tip("您未做任何修改,无需保存！","","noupdate");
			_this.show();
            $(".shengxiao_d").hide();
		}else if(!currediractlist.data || currediractlist.data.length < 1){
		    popup.tip("没有输入任何端口转发规则！","","noupdate");
			_this.show();
            $(".shengxiao_d").hide();
		}else{
		    setredirectinfo(currentrdrmode,currediractlist,"");
		}
	}else{
	    var lastip = $("#dmzlastip").val();
		var re = /^\d+$/;
	    if(lastip == "" || parseInt(lastip) < 1 
		  || parseInt(lastip) > 254 || !re.test(lastip)){ 
		     $("#dmziperror").show();
			 _this.show();
             $(".shengxiao_d").hide();
		}else{
		   var curdmzip = curdmzpreip + lastip;
		  if(currentrdrmode == innerNetBaseSet.redirecttype && curdmzip == innerNetBaseSet.dmzip){
		     popup.tip("您未做任何修改,无需保存！","","noupdate");
			 _this.show();
             $(".shengxiao_d").hide();
		  }else{
		     setredirectinfo(currentrdrmode,currediractlist,curdmzip);
		  }
		}
	}
});

validate($("#UrlFilterSetForm"),{autoReset:true, valiBreak:true,
	submitHandler:function(){
		urlfilterisSuccess = true;
	}
});

$(".tian_jia88").on("click",function(e){
    $(".error-tip").hide();
	$("#domainName").val("");
	$("#domainRef").val("");
	urlfilterisSuccess = false;
    popup.showId("tian_jia88",{layerCss:{position:"fixed",left:"50%",top:"50%",marginLeft:"-185px",marginTop:"-183px"
        },closeBtn:".bi_c",okBtn:".tian_tew",cancelBtn:".quxiao_wi", okbtnmulticlick:true,
        okBtnClick:function(a,b){
		     $("#urlfiltersavebtn").trigger("click");
			if(urlfilterisSuccess){
				var item = {};
				item.domainname = $("#domainName").val();
				item.domainref = $("#domainRef").val();
				if(!cururlfilterlist.data || cururlfilterlist.data.length < 1){
					cururlfilterlist.data = [];
				}
				cururlfilterlist.data.push(item);
				loadCurrentUrlFilterList(cururlfilterlist);
				var pagenum = Math.ceil(cururlfilterlist.data.length/pagesize);	
				initurlfilterpage(cururlfilterlist.data.length,pagenum);
				popup.close(a,b,"hide");
				$(".qing_jia88").show();
				editurllistflag = true;
			}
        }                                     
    });
});
    
$(".qing_jia88").on("click",function(e){
    popup.showId("qing_jia88",{layerCss:{position:"fixed",left:"50%",top:"50%",marginLeft:"-170px",marginTop:"-100px"
        },closeBtn:".mind",okBtn:".kong_tp",cancelBtn:".kong_tp2",
        okBtnClick:function(a,b){
		    if(cururlfilterlist.data && cururlfilterlist.data.length > 0){
			   cururlfilterlist.data.splice(0,cururlfilterlist.data.length);
			   loadCurrentUrlFilterList(cururlfilterlist);
			   initurlfilterpage(0);
		   }
		   $(".qing_jia88").hide();
           popup.close(a,b,"hide");
		   editurllistflag = true;
        }                                     
    });
});

$("#urlfilterlistbox").on("click",".del_urlfilter",function(e){
    editlistindex = -1;
	for(i=0;i<cururlfilterlist.data.length;i++){
	   var itemData=cururlfilterlist.data[i];
	   if($(this).attr("data-name") == itemData.domainname
	      && $(this).attr("data-ref") == itemData.domainref){
		   editlistindex = i;
	   }
	}

	cururlfilterlist.data.splice(editlistindex,1);
    loadCurrentUrlFilterList(cururlfilterlist);
    var pagenum = Math.ceil(editlistindex/pagesize);	
	initurlfilterpage(cururlfilterlist.data.length,pagenum);
	if(!cururlfilterlist.data || cururlfilterlist.data.length < 1){
	    $(".qing_jia88").hide();
	}
	editurllistflag = true;
    e.preventDefault();
});  

$(".bao_bcun2").on("click",function(){
     var _this=$(this);
    _this.hide();
    $(".shengxiao_d").show();
	
	if(currenturlfmode == "0"){
	    if(currenturlfmode == innerNetBaseSet.urlfilterenable){
		    popup.tip("您未做任何修改,无需保存！","","noupdate");
			_this.show();
            $(".shengxiao_d").hide();
		}else{
		    seturlfilterinfo(currenturlfmode,cururlfilterlist);
		}
	}else if(currenturlfmode == "1"){
	    if(currenturlfmode == innerNetBaseSet.urlfilterenable && !editurllistflag){
		    popup.tip("您未做任何修改,无需保存！","","noupdate");
			_this.show();
            $(".shengxiao_d").hide();
		}else{
		    seturlfilterinfo(currenturlfmode,cururlfilterlist);
		}
	}
});

function seturlfilterinfo(mode,list){
     popup.showOpaLay();
     var setParam = {};
	 setParam.urlfilterenable = mode;
	 setParam.urlfilterlist = $.extend(true,[],list.data);
	 for(j=0;j<setParam.urlfilterlist.length;j++){
		setParam.urlfilterlist[j].domainref = urlencode(setParam.urlfilterlist[j].domainref);
	 }
	 
	 var options = {
		type: 'post',
		dataType:"json",
		url: baseUrl+"key="+$.cookie("key")+"&op=set",
		params:{context:createSetContext(setParam)},
		success: function(data) {
		   checkresult(data);
		   if(data.result==0){
			   popup.tip("设置成功！");
			   innerNetBaseSet.urlfilterenable = mode;
		   }else{
				popup.simpleBox({
				  title:"提示",
				  hideCancel:0,
				  content:data.error.desc,
				  okBtnClick:function(layer,overlay){
					 popup.close(layer,overlay);
					 popup.hideOpaLay();
				  }
				});
		  }  
		  $(".bao_bcun2").show();
		  $(".shengxiao_d").hide();
		  popup.hideOpaLay();
		}
	};
	maxdata_post(options);
}

function setredirectinfo(mode,list,ip){
     popup.showOpaLay();
     var setParam = {};
	 setParam.redirecttype = mode;
	 if(mode == "1"){
	     setParam.redirectlist = $.extend(true,[],list.data);
		   for(j=0;j<setParam.redirectlist.length;j++){
			  setParam.redirectlist[j].name = urlencode(setParam.redirectlist[j].name);;
		   }
	 }else if(mode == "2"){
	     setParam.dmzip = ip;
	 }
	 
	 $.getJSON(baseUrl,{op:"set",
		 context:createSetContext(setParam),
		 key:$.cookie("key")},
	 function(data){
	   checkresult(data);
	   if(data.result==0){
	       popup.tip("设置成功！");
	       innerNetBaseSet.redirecttype = currentrdrmode;
		   if (currentrdrmode == "2"){
		       innerNetBaseSet.dmzip = setParam.dmzip;
		   }
	   }else{
			popup.simpleBox({
			  title:"提示",
			  hideCancel:0,
			  content:data.error.desc,
			  okBtnClick:function(layer,overlay){
				 popup.close(layer);
				 popup.hideOpaLay();
			  }
			});
	  }  
	  $(".bao_bcun").show();
      $(".shengxiao_d").hide();
	  popup.hideOpaLay();
	}); 
}

$("#dmzlastip").on("click",function(){
	$("#dmziperror").hide();
});

$(".duankou_fa").on('click',function(){
    $("#dmziperror").hide();
 });
 
function initurlfilterpage(totalnumber,currentpage)
{
    var pagenum = Math.ceil(totalnumber/pagesize);
	var curpage = currentpage?currentpage:1;
	if(pagenum > 1 ){
	    document.getElementById("urlfilterpage").style.display="block";
		laypage({cont: 'urlfilterpage',pages: pagenum,curr: curpage, 
		  jump: function(e){
			showurlfilterpage(e.curr);
		  }
		});
	}else{
		document.getElementById("urlfilterpage").style.display="none";
	}
	showurlfilterpage(curpage);
}

function showurlfilterpage(number){
    var start = (number-1)*pagesize;
	var end = number*pagesize;
    $(".urlfiltertr").hide();
    $(".urlfiltertr").slice(start, end).show();
}

function refresh_upnp(){
    $(".refreshupnp").addClass("refresh_upnp");
	popup.showOpaLay();
	$.getJSON(baseUrl,
    {op:"get",
     context:createContext("network"),
	 key:$.cookie("key")},
    function(data){
	   checkresult(data);
	   if(data.result==0){
	      if(data.data && data.data.lan){
			  if(data.data.lan && data.data.lan.enable_upnp == "1"){
				  $('#UPnPChange').removeClass("closed").addClass("opened");
				  upnpvalue = "1";
				  upnpCurrentList.show();
				  curupnplist.data = [];
				  if(data.data.lan.upnpdevlist){
				     curupnplist.data = data.data.lan.upnpdevlist;
				  }
			      loadCurrentupnpList(curupnplist);
			  }else{
				  $('#UPnPChange').removeClass("opened").addClass("closed");
				  upnpvalue = "0";
				  upnpCurrentList.hide();
				  curupnplist.data = [];
			  }
			  innerNetBaseSet.enable_upnp = upnpvalue;	  
		  }
	   }
	   popup.hideOpaLay();	
	   $(".refreshupnp").removeClass("refresh_upnp");
	});
}
upnpCurrentList.delegate(".refreshupnp","click",function(){
    refresh_upnp();
});


$("#RDRDIP").addRule("ipcon",function(){
     var value = $("#RDRDIP").val();
	 var ipprev = value.split(".");
	 var preip = ipprev[0]+"."+ipprev[1]+"."+ipprev[2]+".";
     if(curdmzpreip == preip || preip == "192.168.215."){
       return true;
     }
     return false;
});

$("#RDRSPort").addRule("obligate",function(){
     var value = parseInt($("#RDRSPort").val());
     if(value == 8908 || value == 8909 || value == 4466){
       return false;
     }
     return true;
});

$("#RDRSPort").addRule("conflict",function(){
     var value = parseInt($("#RDRSPort").val());
	 if(currediractlist.data && currediractlist.data.length > 0){
		 for(i=0;i<currediractlist.data.length;i++){
		   var itemData=currediractlist.data[i];
		   if(editlistindex == i){
			   continue;
		   }
		   if(value == parseInt(itemData.src_dport)){
			   return false;
		   }
		 }
	 }
     return true;
});

$("#domainName").addRule("conflictto",function(){
	 if(cururlfilterlist.data && cururlfilterlist.data.length > 0){
		 for(i=0;i<cururlfilterlist.data.length;i++){
		   var itemData=cururlfilterlist.data[i];
		   if($("#domainName").val() == itemData.domainname){
			   return false;
		   }
		 }
	 }
     return true;
});

validate($("#RDRSetForm"),{autoReset:true, valiBreak:true,
	submitHandler:function(){
		isSuccess = true;
	}
});
			
$(".tian_jia").on("click",function(e){
    $("#RDRname").val("");
	$("#RDRSPort").val("");
	$("#RDRDIP").val("");
	$("#RDRTPort").val("");
	$("#RDRProto").html("TCP");
	isSuccess = false;
	editlistindex = -1;
	$(".kou_r").html("添 加");
	$(".error-tip").hide();
    popup.showId("tian_jia",{layerCss:{position:"fixed",left:"50%",top:"50%",marginLeft:"-185px", marginTop:"-207px"},
	    closeBtn:".btn_hov",okBtn:".kou_r", okbtnmulticlick:true,
	    okBtnClick:function(a,b){
		    $("#rdrsavebtn").trigger("click");
			if(isSuccess){
				var item = {};
				item.name = $("#RDRname").val();
				item.dest_ip = $("#RDRDIP").val();
				item.src_dport = $("#RDRSPort").val();
				item.dest_port = $("#RDRTPort").val();
				item.proto = $("#RDRProto").attr("data-panel");
				if(!currediractlist.data || currediractlist.data.length < 1){
					currediractlist.data = [];
				}
				currediractlist.data.push(item);
				loadCurrentrdrList(currediractlist);
				editlistflag = true;
			    popup.close(a,b,"hide");
			} 
        }                                     
    });
});

$("#duankou_fa").on("click",".del_pas",function(e){
    editlistindex = -1;
	for(i=0;i<currediractlist.data.length;i++){
	   var itemData=currediractlist.data[i];
	   if($(this).attr("data-name") == itemData.name
	      && $(this).attr("data-port") == itemData.src_dport){
		   editlistindex = i;
	   }
	}
	currediractlist.data.splice(editlistindex,1);
    loadCurrentrdrList(currediractlist);
	editlistflag = true;
    e.preventDefault();
});  
    
$("#duankou_fa").on("click",".bian_k",function(e){
	isSuccess = false;
	editlistindex = -1;
	$(".kou_r").html("确 定");
	for(i=0;i<currediractlist.data.length;i++){
	   var itemData=currediractlist.data[i];
	   if($(this).attr("data-name") == itemData.name
	      && $(this).attr("data-port") == itemData.src_dport){
		   editlistindex = i;
		   $("#RDRname").val(itemData.name);
	       $("#RDRSPort").val(itemData.src_dport);
	       $("#RDRDIP").val(itemData.dest_ip);
	       $("#RDRTPort").val(itemData.dest_port);
		   if(itemData.proto=="tcp"){
		       $("#RDRProto").html("TCP");
		   }else if(itemData.proto=="udp"){
		       $("#RDRProto").html("UDP");
		   }else{
		       $("#RDRProto").html("TCP+UDP");
		   }
		   $("#RDRProto").attr("data-panel",itemData.proto);
	   }
	}
	
    popup.showId("tian_jia",{layerCss:{position:"fixed",left:"50%",top:"50%",marginLeft:"-185px", marginTop:"-207px"},
	    closeBtn:".btn_hov",okBtn:".kou_r", okbtnmulticlick:true,
        okBtnClick:function(a,b){
			$("#rdrsavebtn").trigger("click");
			if(isSuccess){
				currediractlist.data[editlistindex].name = $("#RDRname").val();
				currediractlist.data[editlistindex].dest_ip = $("#RDRDIP").val();
				currediractlist.data[editlistindex].src_dport = $("#RDRSPort").val();
				currediractlist.data[editlistindex].dest_port = $("#RDRTPort").val();
				currediractlist.data[editlistindex].proto = $("#RDRProto").attr("data-panel");
				loadCurrentrdrList(currediractlist);
				editlistflag = true;
			    popup.close(a,b,"hide");
			} 
        }                                     
    });
});

$(function(){
        $('.nei_zhi a').each(function(index){
            $(this).click(function(){
                $('.nei_zhi .riadod').removeClass('active_radio');
                $(this).addClass('active_radio');
                $('.conFocus_be').hide();
                $('.conFocus_be:eq('+index+')').show();
				if(index==0){
				    currentrdrmode = "1";
				}else{
				    currentrdrmode = "2";
				}
            })
        });
    });
	
var divselect=$("#divselect");
divselect.find(".label").on("click",function(e){
	var optList=divselect.find(".list");
	if(optList.is(":visible")){
		$(this).removeClass("open");
		optList.hide();
	}else{
		$(this).addClass("open");
		optList.show(); 
	}
	e.stopPropagation();
});

divselect.on("click",'li>a',function(e){
 var label=divselect.find(".label");
 var optList=divselect.find(".list");
 label.text($(this).text()).removeClass("open");
 label.attr("data-panel", $(this).attr("data-panel"));
 optList.hide();
 e.preventDefault();    
});  
$('.box').Tabs({event:'click',callback:null});

checkcookie();

var tmpstr = window.location.href;
if(tmpstr.match("lightmode")){
    $(".tab_menu>li").removeClass("current");
	$(".tab_menu").find('li[data-value="lightmode"]').addClass("current");
	$(".tab_box>div").addClass("hide");
	$(".mianban").removeClass("hide");
};

var dhcpswitchvalue="0";
var lightmodevalue="0";
var upnpvalue="0";

setLightPanel($(".biaozhun"),0);
function setLightPanel(p,flg){
 var lc=p.find(".biao_left");
 var rc=p.find(".biao_right");
 
 var lightnomal = function(){
   lc.addClass("biao_left_hei");
   rc.removeClass("acti_biao_tnu");
   $(".quantian").show();
   $(".yejian").hide();
   lightmodevalue="0";
 };
 
 var lightnight = function(){
   rc.addClass("acti_biao_tnu");
   lc.removeClass("biao_left_hei");
   $(".quantian").hide();
   $(".yejian").show();
   lightmodevalue="1";
 };
 
 lc.on("click",lightnomal);
 rc.on("click",lightnight);
 
 if(flg && flg==1){lightnight();}else{lightnomal();}
}

$('#DHCPChange').on("click",function(){
	 var _this=$(this);
	if(_this.hasClass("closed")){
	  _this.removeClass("closed").addClass("opened");
	  $(".fenpeifanwei").show();
	  dhcpswitchvalue="0";
	}else{
	 _this.removeClass("opened").addClass("closed");
	 $(".fenpeifanwei").hide();
	 dhcpswitchvalue="1";
	}
});

$('#UPnPChange').on("click",function(){
	 var _this=$(this);
	if(_this.hasClass("closed")){
	  _this.removeClass("closed").addClass("opened"); 
	  upnpvalue = "1";
	  if(innerNetBaseSet.enable_upnp == "1"){
	      upnpCurrentList.show();
	  }else{
	      upnpCurrentList.hide();
	  }
	}else{
	 _this.removeClass("opened").addClass("closed");
	 upnpvalue = "0";
	 upnpCurrentList.hide();
	}
	$("#saveUPnP").show();
});

$("#rangeTo1").addRule("size",function(){
     if(parseInt($(this).val())>parseInt($("#rangeFrom1").val())){
       return true;
     }
     return false;
});
   
$("#minto").addRule("sparetime",function(){
 if(parseFloat($("#minto").val()) == parseFloat($("#minfrom").val()) 
	 && parseFloat($("#hourto").val()) == parseFloat($("#hourfrom").val()))
 {
   return false;
 }
 return true;
});

popup.showOpaLay();	
$.getJSON(baseUrl,
    {op:"get",
     context:createContext("network"),
	 key:$.cookie("key")},
    function(data){
	   checkresult(data);
	   if(data.result==0){
	      if(data.data && data.data.lan){
		      $("#lanipaddr").val(data.data.lan.ipaddr);
		      $("#lannetmask").val(data.data.lan.netmask);
			  innerNetBaseSet.ipaddr=data.data.lan.ipaddr;
              innerNetBaseSet.netmask=data.data.lan.netmask;
			  if(data.data.lan && data.data.lan.dhcp_switch){
				  if(data.data.lan.dhcp_switch == "0"){
					  $('#DHCPChange').attr('class', 'dhcp_open opened');
					  $(".fenpeifanwei").show();
					  dhcpswitchvalue="0";
				  }else{
					  $('#DHCPChange').attr('class', 'dhcp_open closed');
					  $(".fenpeifanwei").hide();
					  dhcpswitchvalue="1";
				  }
				  $('#rangeFrom1').attr('value', data.data.lan.dhcp_start_ip);
				  $('#rangeTo1').attr('value', data.data.lan.dhcp_stop_ip);
				  $('#ipSection').html(data.data.lan.dhcp_pre_ip);
				  
				  innerNetBaseSet.dhcp_switch = dhcpswitchvalue;
				  innerNetBaseSet.dhcp_start_ip = data.data.lan.dhcp_start_ip;
				  innerNetBaseSet.dhcp_stop_ip = data.data.lan.dhcp_stop_ip;
				  innerNetBaseSet.dhcp_pre_ip = data.data.lan.dhcp_pre_ip;  
				  
			  }
			  
			  if(data.data.lan && data.data.lan.enable_upnp == "1"){
				  $('#UPnPChange').removeClass("closed").addClass("opened");
				  //$("#UPnPRef").html("局域网中的UPnP设备彼此已经可以自动连接和协同工作。");
				  upnpvalue = "1";
				  curupnplist.data = [];
				  upnpCurrentList.show();
				  if(data.data.lan.upnpdevlist){
				     curupnplist.data = data.data.lan.upnpdevlist;
				  }
			      loadCurrentupnpList(curupnplist);
			  }else{
				  $('#UPnPChange').removeClass("opened").addClass("closed");
				  //$("#UPnPRef").html("开启后，局域网中的UPnP设备彼此可自动连接和协同工作。");
				  upnpvalue = "0";
				  upnpCurrentList.hide();
				  curupnplist.data = [];
				  $("#saveUPnP").hide();
				  //loadCurrentupnpList(curupnplist);
			  }
			  innerNetBaseSet.enable_upnp = upnpvalue;
			  
			  if(data.data.wan && data.data.wan.mtu){
			      $("#MTU").val(data.data.wan.mtu);
				  innerNetBaseSet.mtu = $("#MTU").val();
			  }
			  
			  if(data.data.lightmode){
			        if(data.data.lightmode == "0"){
				        setLightPanel($(".biaozhun"),0);
				    }else{
				        setLightPanel($(".biaozhun"),1);
				    }
				  
				    if(data.data.lighttime){
						var timearr = data.data.lighttime.split('-');
						var fromarr = timearr[0].split(':');
						var toarr = timearr[1].split(':');
						$("#hourfrom").val(fromarr[0]);
						$("#minfrom").val(fromarr[1]);
						$("#hourto").val(toarr[0]);
						$("#minto").val(toarr[1]);
				   }
				   innerNetBaseSet.lightmode = data.data.lightmode;
				   innerNetBaseSet.lighttime = data.data.lighttime;   
			  }
			  
			  if(data.data.redirecttype){
			      if(data.data.redirecttype == "0"){
				      $('.guan_close').addClass("closre");
                      $(".duankou_fa").hide();
					  $('#redirectradio').addClass("active_radio");
					  $('#dmzradio').removeClass("active_radio"); 
					  $('#dmzpanal').hide();
					  $('#redirectpanal').show();
					  $(".bao_bcun").hide();
				  }else if(data.data.redirecttype == "1"){
				      $('.guan_close').removeClass("closre");
                      $(".duankou_fa").show();
					  $('#redirectradio').addClass("active_radio");
					  $('#dmzradio').removeClass("active_radio"); 
					  $('#dmzpanal').hide();
					  $('#redirectpanal').show();
				  }else{
				      $('.guan_close').removeClass("closre");
                      $(".duankou_fa").show();
					  $('#redirectradio').removeClass("active_radio");
					  $('#dmzradio').addClass("active_radio");
					  $('#dmzpanal').show();
					  $('#redirectpanal').hide();
				  }
				  
				  if(data.data.redirectlist && data.data.redirectlist.length > 0){
				      currediractlist.data = [];
				      currediractlist.data = $.extend(true,[],data.data.redirectlist);
					  for(j=0;j<currediractlist.data.length;j++){
                        currediractlist.data[j].name = urldecode(currediractlist.data[j].name);
					  }
				  }
				  loadCurrentrdrList(currediractlist);
				  
				  var ipprev = data.data.lan.ipaddr.split(".");
				  var preip = ipprev[0]+"."+ipprev[1]+"."+ipprev[2]+".";
				  curdmzpreip = preip;
				  if(data.data.dmzip){
				      var dmzlastip = data.data.dmzip.split(".");
				      $('#dmzpreip').html(preip+"&nbsp;");
				      $('#dmzlastip').val(dmzlastip[3]);
				  }else{
				      
				      $('#dmzpreip').html(preip+"&nbsp;");
				      $('#dmzlastip').val("");
				  }
				  
				  currentrdrmode = data.data.redirecttype;
				  innerNetBaseSet.redirecttype = data.data.redirecttype;
				  innerNetBaseSet.dmzip = data.data.dmzip; 
			  }
			  
			  if(data.data.urlfilterenable){
			      if(data.data.urlfilterenable == "0"){
				      $('.guan_close2').addClass("closre");
                      $("#urlfilterlistbox").hide();
					  $(".bao_bcun2").hide();
				  }else{
				      $('.guan_close2').removeClass("closre");
                      $("#urlfilterlistbox").show();
				  }
			      
				  var totalnum = 0;
				  if(data.data.urlfilterlist && data.data.urlfilterlist.length > 0){
				      cururlfilterlist.data = [];
				      cururlfilterlist.data = $.extend(true,[],data.data.urlfilterlist);
					  for(j=0;j<cururlfilterlist.data.length;j++){
                        cururlfilterlist.data[j].domainref = urldecode(cururlfilterlist.data[j].domainref);
					  }
					  totalnum = cururlfilterlist.data.length;
				  } 
				  
				  loadCurrentUrlFilterList(cururlfilterlist);
				  initurlfilterpage(totalnum);
				  
				  currenturlfmode = data.data.urlfilterenable;
				  innerNetBaseSet.urlfilterenable = data.data.urlfilterenable;
			  }
		  }
		  $("#youkuversion").html(data.data.curver);
		  $("#wanmac").html(data.data.MacAddr);
		  $("#wanIP").html(data.data.wanIP);
	   }
	   popup.hideOpaLay();	
	});

//渲染端口转发名单
function loadCurrentrdrList(list){
	if(list.data && list.data.length==0) list.data=false;
	 var tmpl=document.getElementById('currentrdrListTemplate').innerHTML;
	 var doTtmpl = doT.template(tmpl)(list);
	 rdrCurrentList.html(doTtmpl);
}

function loadCurrentupnpList(list){
	if(list.data && list.data.length==0) list.data=false;
	 var tmpl=document.getElementById('currentupnpListTemplate').innerHTML;
	 var doTtmpl = doT.template(tmpl)(list);
	 upnpCurrentList.html(doTtmpl);
}

function loadCurrentUrlFilterList(list){
    if(list.data && list.data.length==0) {
	    list.data=false;
		$(".qing_jia88").hide();
	}else{
	    $(".qing_jia88").show();
	}
	 var tmpl=document.getElementById('currenturlfilterListTemplate').innerHTML;
	 var doTtmpl = doT.template(tmpl)(list);
	 urlfilterCurrentList.html(doTtmpl);
}

$("#useDefaultMTU").on("click",function(){
	$("#MTU").val(1492);
});

//MTU验证
validate($("#MTUSetForm"),{
    errTipId:"MTUErr",
    valiBreak:true,//每次只验证一个,
	submitHandler:function(){
	  if(innerNetBaseSet.mtu != $("#MTU").val()){
	    var submitBtn=$("#saveSetMTU");
		formSaveBtnState.loading(submitBtn,"正在生效...");
		var setParam = {};
		var wanparam = {};
		wanparam.mtu = $("#MTU").val(); 
		setParam.wan = wanparam; 
		$.getJSON(baseUrl,{op:"set",
			 context:createSetContext(setParam),
			 key:$.cookie("key")},
		 function(data){
		   checkresult(data);
		   formSaveBtnState.resetInit(submitBtn);
		   popup.tip("设置成功！");
		   innerNetBaseSet.mtu=$("#MTU").val();
		});   
	  }else{
	    popup.tip("您未做任何修改,无需保存！","","noupdate");
	  }
	}
});

//验证内网基本设置表单
   validate($("#innerNetBaseSetForm"),{
     submitHandler:function(){
        var ipaddr = $('#lanipaddr').val();                                         
        var netmask = $('#lannetmask').val();
        var submitBtn=$("#saveNetWork");
        if(innerNetBaseSet.ipaddr!=ipaddr || innerNetBaseSet.netmask!=netmask){
           popup.simpleBox({
            title:"重启路由器",
            content:"修改子网掩码和网关需要重启路由器，您确定现在要重启吗？",
            okBtnClick:function(layer,overlay){
            formSaveBtnState.loading(submitBtn,"正在生效...");
			var setParam = {};
	        var lanparam = {};
	        lanparam.ipaddr = ipaddr; 
			lanparam.netmask = netmask; 
	        setParam.lan = lanparam;
			
            $.getJSON( baseUrl,{op:"set",
                context:createSetContext(setParam),
	            key:$.cookie("key")},
			 function(data){
			    checkresult(data);
                formSaveBtnState.resetInit(submitBtn);
                popup.close(layer);
                popup.reConnect(5000,"修改子网掩码和网关需要重启路由器，正在重启中...");
                innerNetBaseSet.ipaddr=ipaddr;
                innerNetBaseSet.netmask=netmask;
            });
          }
          });
        }else{
          popup.tip("您未做任何修改,无需保存！","","noupdate");
        }
     }
   });
   
   //验证DHCP填写表单
   validate($("#DHCPSetForm"),{
      errTipId:"DHCPErr",
      valiBreak:true,//每次只验证一个,
      submitHandler:function(){
	    if(innerNetBaseSet.dhcp_switch!=dhcpswitchvalue || innerNetBaseSet.dhcp_start_ip!=$('#rangeFrom1').val() || innerNetBaseSet.dhcp_stop_ip!=$('#rangeTo1').val()){
				popup.simpleBox({
				  title:"提示",
                hideCancel:0,
				  content:"修改DHCP需要重启路由器，您确定现在要重启吗？",
				  okBtnClick:function(layer,overlay){
					 submitDHCPSet(layer);
				  }
				});
        }else{
          popup.tip("您未做任何修改,无需保存！","","noupdate");
       }}
   });
   
   function submitDHCPSet(layer){
     var submitBtn=$("#saveDHCPSet");
     formSaveBtnState.loading(submitBtn,"正在生效..."); 
	 var setParam = {};
	 var lanparam = {};
	 lanparam.dhcp_switch = dhcpswitchvalue; 
	 lanparam.dhcp_pre_ip = $('#ipSection').html(); 
	 lanparam.dhcp_start_ip = $('#rangeFrom1').val(); 
	 lanparam.dhcp_stop_ip = $('#rangeTo1').val();  
	 setParam.lan = lanparam;
	 
	 $.getJSON( baseUrl,{op:"set",
                context:createSetContext(setParam),
	            key:$.cookie("key")}, 
		  function(data){
		   checkresult(data);
           formSaveBtnState.resetInit(submitBtn);
           popup.close(layer);
           popup.reConnect(5000,"修改DHCP需要重启路由器，正在重启中...");
      } );     
    };

   //验证light表单
    validate($("#lightsetForm"),{
      errTipId:"LightErr",
      valiBreak:true,//每次只验证一个,
      submitHandler:function(){
        var lighttime= $("#hourfrom").val() + ":" + $("#minfrom").val() + "-" + $("#hourto").val() + ":" + $("#minto").val();
		if(innerNetBaseSet.lightmode!=lightmodevalue || innerNetBaseSet.lighttime!=lighttime){
		    var submitBtn=$("#saveLight");
		    formSaveBtnState.loading(submitBtn,"正在生效...");
		     var setParam = {};
		     setParam.lightmode = lightmodevalue;
		     setParam.lighttime = lighttime;
	         $.getJSON(baseUrl,{op:"set",
                context:createSetContext(setParam),
	            key:$.cookie("key")},
		        function(data){ 
				   checkresult(data);
			       popup.tip("设置成功！");  
				   formSaveBtnState.resetInit(submitBtn);
				   innerNetBaseSet.lightmode=lightmodevalue;
				   innerNetBaseSet.lighttime=lighttime;
		        });
	    }else{
          popup.tip("您未做任何修改,无需保存！","","noupdate");
       }
      }
    });

$("#saveUPnP").on("click",function(){submitUpnpSet();});
function submitUpnpSet(){
    var submitBtn=$("#saveUPnP");
	if(innerNetBaseSet.enable_upnp!=upnpvalue){
		formSaveBtnState.loading(submitBtn,"正在生效...");
		var setParam = {};
		var lanparam = {};
		lanparam.upnp = upnpvalue; 
		setParam.lan = lanparam;
		$.getJSON(baseUrl,{op:"set",
			 context:createSetContext(setParam),
			 key:$.cookie("key")},
		 function(data){
		   checkresult(data);
		   formSaveBtnState.resetInit(submitBtn);
		   popup.tip("设置成功！");
		   innerNetBaseSet.enable_upnp=upnpvalue;
		   refresh_upnp();
		}); 
    }else{
	    popup.tip("您未做任何修改,无需保存！","","noupdate");
    }	
}

$("#logoutbtn").on("click",function(){ weblogout();});
	
</script>
</body>
</html>
